## 介绍
在写dockerfile构建镜像时，常常会下载很多外国的依赖，如果在本地mac上构建网络不好就很慢，影响效率。
因此，可以结合github保管源码，使用阿里云云效拉取源码并推送镜像到阿里云的仓库里。这样就可以不使用本地mac构建镜像，节省空间，也比较快。因为最终的镜像是在阿里云的仓库里的，本地拉取也很快。

## 创建阿里云容器镜像仓库
一个仓库对应最终的一个镜像。下面的目标最终是要构建出一个自定义的kafka镜像。
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667010049121-b9b34821-8e52-476d-b0ac-21118e3e6b77.png#clientId=u3140dc1f-70a4-4&from=paste&height=871&id=ufff9dc57&name=%E5%9B%BE%E7%89%87.png&originHeight=871&originWidth=1689&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105284&status=done&style=none&taskId=u0d480050-c848-4cef-860a-10af6fe4203&title=&width=1689)
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667010043511-6c2a129e-5e20-4e47-9c4f-a4721d3504b4.png#clientId=u3140dc1f-70a4-4&from=paste&height=800&id=ua7cb0101&name=%E5%9B%BE%E7%89%87.png&originHeight=800&originWidth=1656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=93501&status=done&style=none&taskId=u48134b8d-1022-47f2-bcf2-12999b26053&title=&width=1656)![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667010131037-de6272a4-7854-4c62-aebe-ad10b990e672.png#clientId=u3140dc1f-70a4-4&from=paste&height=404&id=u2d49402d&name=%E5%9B%BE%E7%89%87.png&originHeight=404&originWidth=1873&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56923&status=done&style=none&taskId=u05455521-e59e-4732-b12e-3e21c9adda1&title=&width=1873)


## 在云效中创建flow
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667010942860-299074ef-bbc4-43df-b660-d8c787882dde.png#clientId=u3140dc1f-70a4-4&from=paste&height=455&id=ud9c1a626&name=%E5%9B%BE%E7%89%87.png&originHeight=455&originWidth=1880&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77149&status=done&style=none&taskId=u8d286309-f092-421f-a8a6-8abc4c1a062&title=&width=1880)
选中github中的仓库![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667010966712-ffe6e6e6-1483-4bf0-b72f-17f22dcdccb6.png#clientId=u3140dc1f-70a4-4&from=paste&height=882&id=u4b1733e7&name=%E5%9B%BE%E7%89%87.png&originHeight=882&originWidth=1888&originalType=binary&ratio=1&rotation=0&showTitle=false&size=118719&status=done&style=none&taskId=u9540c70f-fc42-4592-a196-7e63ea815f1&title=&width=1888)绑定阿里云的镜像仓库，即刚刚上面建的那个play-kafka
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667011070992-753d1a2b-cd04-4db4-8ffb-570cd35f2662.png#clientId=u3140dc1f-70a4-4&from=paste&height=941&id=u875efc0a&name=%E5%9B%BE%E7%89%87.png&originHeight=941&originWidth=1865&originalType=binary&ratio=1&rotation=0&showTitle=false&size=145765&status=done&style=none&taskId=u814849d5-1e66-4eb2-a2cd-72c75530eeb&title=&width=1865)
指定源代码中Dockefile的地址
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667011031160-00a61c38-3ea1-42c6-babc-d9c4f628f8cf.png#clientId=u3140dc1f-70a4-4&from=paste&height=938&id=u62c53f31&name=%E5%9B%BE%E7%89%87.png&originHeight=938&originWidth=1869&originalType=binary&ratio=1&rotation=0&showTitle=false&size=142742&status=done&style=none&taskId=udc758197-0709-43a0-a9c0-ca8b33638c4&title=&width=1869)对应github上的地址
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667011115528-b2456828-4ebb-4bf7-86be-e700eb5bf5c3.png#clientId=u3140dc1f-70a4-4&from=paste&height=766&id=u2dfd0992&name=%E5%9B%BE%E7%89%87.png&originHeight=766&originWidth=1747&originalType=binary&ratio=1&rotation=0&showTitle=false&size=164726&status=done&style=none&taskId=u3e7d37cc-1df3-4258-a910-09c6c745aa0&title=&width=1747)点击保存运行
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667011150753-fb107bd1-2c93-4752-a108-891af8e972ed.png#clientId=u3140dc1f-70a4-4&from=paste&height=701&id=uec5b6561&name=%E5%9B%BE%E7%89%87.png&originHeight=701&originWidth=1889&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134949&status=done&style=none&taskId=u4c0fe365-d502-435b-8380-7f1b6369af7&title=&width=1889)可以看到正在运行构建了。
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667011178466-a248dd91-efdc-40ff-83f9-c9d07bd74043.png#clientId=u3140dc1f-70a4-4&from=paste&height=913&id=ub25fdbf2&name=%E5%9B%BE%E7%89%87.png&originHeight=913&originWidth=1891&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112447&status=done&style=none&taskId=u13b522a1-9d2c-4e6c-ace0-392c523eaba&title=&width=1891)

## 本地拉取云效构建完的镜像
打开阿里云镜像仓库，可以看到构建好的镜像
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667021095516-192a2fb8-a00c-43f3-9c64-aac3a5cdfc1b.png#clientId=ufb06f307-27a3-4&from=paste&height=487&id=u1dc92a2d&name=%E5%9B%BE%E7%89%87.png&originHeight=487&originWidth=1903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=83341&status=done&style=none&taskId=u199ab152-e7cd-4124-b5cf-f50de8d1c99&title=&width=1903)本地mac上执行拉取
```xml
docker pull registry.cn-hangzhou.aliyuncs.com/cum/play-kafka:2022-10-29-10-22-49
```
![图片.png](https://cdn.nlark.com/yuque/0/2022/png/637656/1667021201193-3c170f3c-9ee0-4fac-b887-07881a2ef6bb.png#clientId=ufb06f307-27a3-4&from=paste&height=445&id=u95c00cad&name=%E5%9B%BE%E7%89%87.png&originHeight=445&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88876&status=done&style=none&taskId=u83372d73-acb3-4f04-8650-76ff3796f50&title=&width=930)
